---
title: 'Metadata Filtering'
description: 'Advanced filtering for search and retrieval'
---

# Metadata Filtering

Filter search results by metadata attributes. Use logical operators and data type comparisons to find exactly what you need.

## Basic Filtering

### Equality & Not Equal

<CodeGroup>

```python Python
from nebula import Nebula
nebula = Nebula(api_key="your-api-key")

# Simple equality
results = nebula.search(
    query="machine learning",
    collection_ids=["my-collection"],
    filters={"metadata.category": "research"}
)

# Not equal
results = nebula.search(
    query="documents",
    collection_ids=["docs"],
    filters={"metadata.status": {"$ne": "archived"}}
)
```

```javascript JavaScript
const { Nebula } = require('@nebula-ai/sdk');
const nebula = new Nebula({ apiKey: 'your-api-key' });

// Simple equality
const results = await nebula.search({
  query: "machine learning",
  collection_ids: ["my-collection"],
  filters: {"metadata.category": "research"}
});

// Not equal
const results2 = await nebula.search({
  query: "documents",
  collection_ids: ["docs"],
  filters: {"metadata.status": {"$ne": "archived"}}
});
```

```bash cURL
# Simple equality
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "machine learning",
    "collection_ids": ["my-collection"],
    "filters": {"metadata.category": "research"}
  }'

# Not equal
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "documents",
    "collection_ids": ["docs"],
    "filters": {"metadata.status": {"$ne": "archived"}}
  }'
```

</CodeGroup>

### Numeric Comparisons

<CodeGroup>

```python Python
# Greater than or equal
results = nebula.search(
    query="high priority tasks",
    collection_ids=["tasks"],
    filters={"metadata.priority": {"$gte": 7}}
)

# Range (between values)
results = nebula.search(
    query="quality content",
    collection_ids=["content"],
    filters={
        "$and": [
            {"metadata.score": {"$gte": 80}},
            {"metadata.score": {"$lte": 95}}
        ]
    }
)
```

```javascript JavaScript
// Greater than or equal
const results = await nebula.search({
  query: "high priority tasks",
  collection_ids: ["tasks"],
  filters: {"metadata.priority": {"$gte": 7}}
});

// Range (between values)
const results2 = await nebula.search({
  query: "quality content",
  collection_ids: ["content"],
  filters: {
    "$and": [
      {"metadata.score": {"$gte": 80}},
      {"metadata.score": {"$lte": 95}}
    ]
  }
});
```

```bash cURL
# Greater than or equal
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "high priority tasks",
    "collection_ids": ["tasks"],
    "filters": {"metadata.priority": {"$gte": 7}}
  }'

# Range (between values)
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "quality content",
    "collection_ids": ["content"],
    "filters": {
      "$and": [
        {"metadata.score": {"$gte": 80}},
        {"metadata.score": {"$lte": 95}}
      ]
    }
  }'
```

</CodeGroup>

**Operators**: `$gt`, `$gte`, `$lt`, `$lte`

### String Matching

<CodeGroup>

```python Python
# Case-insensitive pattern matching
results = nebula.search(
    query="employees",
    collection_ids=["team"],
    filters={"metadata.email": {"$ilike": "%@company.com"}}
)

# Case-sensitive pattern matching
results = nebula.search(
    query="documents",
    collection_ids=["docs"],
    filters={"metadata.title": {"$like": "Important%"}}
)
```

```javascript JavaScript
// Case-insensitive pattern matching
const results = await nebula.search({
  query: "employees",
  collection_ids: ["team"],
  filters: {"metadata.email": {"$ilike": "%@company.com"}}
});

// Case-sensitive pattern matching
const results2 = await nebula.search({
  query: "documents",
  collection_ids: ["docs"],
  filters: {"metadata.title": {"$like": "Important%"}}
});
```

```bash cURL
# Case-insensitive pattern matching
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "employees",
    "collection_ids": ["team"],
    "filters": {"metadata.email": {"$ilike": "%@company.com"}}
  }'

# Case-sensitive pattern matching
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "documents",
    "collection_ids": ["docs"],
    "filters": {"metadata.title": {"$like": "Important%"}}
  }'
```

</CodeGroup>

**Operators**: `$like` (case-sensitive), `$ilike` (case-insensitive). Use `%` as wildcard.

## Advanced Filtering

### Array Operations

<CodeGroup>

```python Python
# Has any of these tags
results = nebula.search(
    query="content",
    collection_ids=["posts"],
    filters={"metadata.tags": {"$overlap": ["urgent", "important"]}}
)

# Has all of these skills
results = nebula.search(
    query="candidates",
    collection_ids=["hr"],
    filters={"metadata.skills": {"$contains": ["python", "ml"]}}
)

# Exact value match
results = nebula.search(
    query="items",
    collection_ids=["inventory"],
    filters={"metadata.category": {"$in": ["electronics", "books"]}}
)
```

```javascript JavaScript
// Has any of these tags
const results = await nebula.search({
  query: "content",
  collection_ids: ["posts"],
  filters: {"metadata.tags": {"$overlap": ["urgent", "important"]}}
});

// Has all of these skills
const results2 = await nebula.search({
  query: "candidates",
  collection_ids: ["hr"],
  filters: {"metadata.skills": {"$contains": ["python", "ml"]}}
});

// Exact value match
const results3 = await nebula.search({
  query: "items",
  collection_ids: ["inventory"],
  filters: {"metadata.category": {"$in": ["electronics", "books"]}}
});
```

```bash cURL
# Has any of these tags
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "content",
    "collection_ids": ["posts"],
    "filters": {"metadata.tags": {"$overlap": ["urgent", "important"]}}
  }'

# Has all of these skills
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "candidates",
    "collection_ids": ["hr"],
    "filters": {"metadata.skills": {"$contains": ["python", "ml"]}}
  }'

# Exact value match
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "items",
    "collection_ids": ["inventory"],
    "filters": {"metadata.category": {"$in": ["electronics", "books"]}}
  }'
```

</CodeGroup>

**Operators**: `$overlap` (has any), `$contains` (has all), `$in` (value in list), `$nin` (not in list)

### Logical Operations

<CodeGroup>

```python Python
# AND: All conditions must match
results = nebula.search(
    query="research papers",
    collection_ids=["academic"],
    filters={
        "$and": [
            {"metadata.verified": True},
            {"metadata.score": {"$gte": 85}},
            {"metadata.department": "ai"}
        ]
    }
)

# OR: Any condition can match
results = nebula.search(
    query="urgent items",
    collection_ids=["tasks"],
    filters={
        "$or": [
            {"metadata.urgent": True},
            {"metadata.priority": {"$gte": 9}},
            {"metadata.deadline": {"$lte": "2024-12-31"}}
        ]
    }
)
```

```javascript JavaScript
// AND: All conditions must match
const results = await nebula.search({
  query: "research papers",
  collection_ids: ["academic"],
  filters: {
    "$and": [
      {"metadata.verified": true},
      {"metadata.score": {"$gte": 85}},
      {"metadata.department": "ai"}
    ]
  }
});

// OR: Any condition can match
const results2 = await nebula.search({
  query: "urgent items",
  collection_ids: ["tasks"],
  filters: {
    "$or": [
      {"metadata.urgent": true},
      {"metadata.priority": {"$gte": 9}},
      {"metadata.deadline": {"$lte": "2024-12-31"}}
    ]
  }
});
```

```bash cURL
# AND: All conditions must match
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "research papers",
    "collection_ids": ["academic"],
    "filters": {
      "$and": [
        {"metadata.verified": true},
        {"metadata.score": {"$gte": 85}},
        {"metadata.department": "ai"}
      ]
    }
  }'

# OR: Any condition can match
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "urgent items",
    "collection_ids": ["tasks"],
    "filters": {
      "$or": [
        {"metadata.urgent": true},
        {"metadata.priority": {"$gte": 9}},
        {"metadata.deadline": {"$lte": "2024-12-31"}}
      ]
    }
  }'
```

</CodeGroup>

### Nested Objects

<CodeGroup>

```python Python
# Filter nested object properties
results = nebula.search(
    query="user profiles",
    collection_ids=["users"],
    filters={
        "metadata.user.profile.age": {"$gte": 25},
        "metadata.user.location.city": "San Francisco"
    }
)
```

```javascript JavaScript
// Filter nested object properties
const results = await nebula.search({
  query: "user profiles",
  collection_ids: ["users"],
  filters: {
    "metadata.user.profile.age": {"$gte": 25},
    "metadata.user.location.city": "San Francisco"
  }
});
```

```bash cURL
# Filter nested object properties
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "user profiles",
    "collection_ids": ["users"],
    "filters": {
      "metadata.user.profile.age": {"$gte": 25},
      "metadata.user.location.city": "San Francisco"
    }
  }'
```

</CodeGroup>

## Common Patterns

### Date Ranges
```python
from datetime import datetime, timedelta

# Last 30 days
start_date = (datetime.now() - timedelta(days=30)).isoformat()
filters = {"metadata.created_at": {"$gte": start_date}}

# Specific date range
filters = {
    "$and": [
        {"metadata.created_at": {"$gte": "2024-01-01"}},
        {"metadata.created_at": {"$lte": "2024-12-31"}}
    ]
}
```

```bash cURL
# Last 30 days
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "recent activity",
    "filters": {"metadata.created_at": {"$gte": "REPLACE_WITH_ISO_START"}}
  }'

# Specific date range
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "reports",
    "filters": {
      "$and": [
        {"metadata.created_at": {"$gte": "2024-01-01"}},
        {"metadata.created_at": {"$lte": "2024-12-31"}}
      ]
    }
  }'
```

### Multi-Status Filtering
```python
# Include specific statuses
filters = {"metadata.status": {"$in": ["pending", "in_progress", "review"]}}

# Exclude specific statuses
filters = {"metadata.status": {"$nin": ["archived", "deleted"]}}
```

```bash cURL
# Include specific statuses
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "tasks",
    "filters": {"metadata.status": {"$in": ["pending", "in_progress", "review"]}}
  }'

# Exclude specific statuses
curl -X POST "https://api.nebulacloud.app/v1/retrieval/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "query": "tasks",
    "filters": {"metadata.status": {"$nin": ["archived", "deleted"]}}
  }'
```

## Best Practices

- **Use proper data types**: Store numbers as numbers, booleans as booleans
- **Start simple**: Begin with basic equality, add complexity as needed
- **Test incrementally**: Build complex queries step by step
- **Use appropriate array operators**: `$overlap` for "any of", `$contains` for "all of"

## Next Steps

- [Core Concepts](/guides/concepts) - Understanding memories and Nebula's architecture
- [Memory Operations Guide](/guides/memory-operations) - Search strategies and examples
- [Collections Guide](/guides/collections) - Organizing your memories  
- [Advanced Features](/guides/advanced-features) - Chunk-level authority and optimization
